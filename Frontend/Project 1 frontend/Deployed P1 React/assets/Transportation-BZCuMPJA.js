import{l as e,m as t,n,s as r,t as i}from"./index-Dy5shDWX.js";import{t as a}from"./Loading-Dkvs0utl.js";import{t as o}from"./dist-B3-LkRQH.js";import"./iconBase-BgoDaE5U.js";import{t as s}from"./bi-CIcH-MPd.js";var c=t(e()),l=t(o()),u=t(n());function d(){let[e,t]=(0,c.useState)([]),[n,o]=(0,c.useState)([]),[d,f]=(0,c.useState)([]),[p,m]=(0,c.useState)([]),{api:h,token:g,user:_,currency:v,startDate:y,endDate:b,selectedSpenderType:x,selectedDestination:S,selectedTransportation:C,setSelectedTransportations:w,transList:T,setTransList:E,transTotal:D,setTransTotal:O,selectedBuddies:k}=(0,c.useContext)(i),[A,j]=(0,c.useState)(1),M=r(),[N,P]=(0,c.useState)(!0);for((0,c.useEffect)(()=>{var n=h+`Destinations/getTransportations?destId=`+S.destinationId+`&currencyId= `+_.currencyId;e.length==0&&fetch(n,{method:`GET`,headers:{Authorization:`Bearer `+g,"Content-Type":`application/json`}}).then(async e=>{e.status==401&&(console.log(`unauthorized`),M(`/`)),t(await e.json()),n=h+`Destinations/getTransportationTypes`,fetch(n,{method:`GET`,headers:{Authorization:`Bearer `+g,"Content-Type":`application/json`}}).then(async e=>{o(await e.json()),n=h+`LoginSignup/getSpenderTypes`,fetch(n,{method:`GET`,headers:{Authorization:`Bearer `+g,"Content-Type":`application/json`}}).then(async e=>{m(await e.json()),n=h+`Destinations/getSuggestedTransportation?spenderTypeId=`+x.spenderTypeId+`&destinationId= `+S.destinationId,fetch(n,{method:`GET`,headers:{Authorization:`Bearer `+g,"Content-Type":`application/json`}}).then(async e=>{f(await e.json()),P(!1)})})})})},[A]);N;)return(0,u.jsx)(a,{});let F=e=>{var e=new Date(e);if(e!=null){let t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();return t+`-`+n+`-`+(r<10?`0`+r:r)}},I=()=>{var e=!0;if(C.length!=T.length)alert(`make sure that you filled in the details for the selected transportation`);else if(T.forEach(t=>{var n=document.getElementById(`t`+t.trans.transportationId);t.num==null||t.num==``?(e=!1,n.textContent=`Please enter the number of times you'll use `+t.trans.transportationName):n.textContent=``}),e){var t=h+`Destinations/getTransTotal?start=`+F(y)+`&end=`+F(b)+`&numOfPeople=`+(k.length+1);fetch(t,{method:`POST`,headers:{Authorization:`Bearer `+g,"Content-Type":`application/json`},body:JSON.stringify(T)}).then(async e=>{O(await e.json()),M(`/vacayPlan/accommodation`)})}},L=()=>{M(-1)},R=e=>{C.find(t=>t.transportationId==e.transportationId)==null?w([...C,e]):(w([...C.filter(t=>t.transportationId!=e.transportationId)]),E([...T.filter(t=>t.trans.transportationId!=e.transportationId)]))},z=e=>C.length==0?`card-ui`:C.find(t=>t.transportationId==e.transportationId)?`selected-card-ui`:`card-ui`,B=(e,t,n)=>{if(t!=0){var r={trans:e,useType:t,num:n};T.find(t=>t.trans==e)==null?E([...T,r]):E([...T.filter(t=>t.trans!=e),r])}},V=n=>{n==2?t(e.sort((e,t)=>e.transportationPricePerPerson-t.transportationPricePerPerson)):n==3?t(e.sort((e,t)=>t.transportationPricePerPerson-e.transportationPricePerPerson)):n==4&&t(e.sort((e,t)=>t.transportationRating-e.transportationRating)),j(n)};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(`div`,{children:[(0,u.jsxs)(`h2`,{children:[`Select transportations from `,S.destinationName]}),(0,u.jsxs)(`select`,{value:A,onChange:e=>V(e.target.value),children:[(0,u.jsx)(`option`,{value:1,children:`Filter by:`}),(0,u.jsx)(`option`,{value:2,children:`Lowest - highest`}),(0,u.jsx)(`option`,{value:3,children:`Highest - lowest`}),(0,u.jsx)(`option`,{value:4,children:`Rating`})]}),(0,u.jsx)(`div`,{className:`cards-section`,children:e.length.length==0?(0,u.jsx)(`p`,{children:`no destination`}):e.map((e,t)=>{var r=d.find(t=>t.transportationId==e.transportationId)!=null;return(0,u.jsxs)(`div`,{className:z(e),onClick:()=>R(e),children:[(0,u.jsxs)(`div`,{className:`card-img`,children:[(0,u.jsx)(`img`,{src:e.transportationImage}),(0,u.jsx)(`div`,{className:`card-rating`,children:(0,u.jsx)(l.Rating,{initialValue:e.transportationRating,readonly:!0,allowFraction:!0,size:`20px`})}),r?(0,u.jsx)(`div`,{className:`suggested`,children:(0,u.jsx)(s,{size:`35px`,color:`yellow`})}):(0,u.jsx)(u.Fragment,{})]}),(0,u.jsx)(`p`,{className:`card-title`,children:e.transportationName}),(0,u.jsxs)(`p`,{children:[v.currencySymbol,` `,e.transportationPricePerPerson,` per person`]}),(0,u.jsxs)(`p`,{children:[e.transportationMinPeople,` - `,e.transportationMaxPeople,` people`]}),(0,u.jsxs)(`p`,{children:[n.find(t=>t.transportationTypeId==e.transportationTypeId).transportationTypeName,` `]})]},t)})})]}),(0,u.jsxs)(`div`,{className:`more-details`,children:[(0,u.jsx)(`h3`,{children:`Fill in details below`}),C.length==0?(0,u.jsx)(`p`,{children:`No transportations selected`}):(0,u.jsx)(u.Fragment,{children:C.map((e,t)=>{var n=T.find(t=>t.trans.transportationId==e.transportationId);return(0,u.jsxs)(`div`,{children:[(0,u.jsx)(`p`,{className:`card-title`,children:e.transportationName}),(0,u.jsx)(`label`,{children:`Type of use for transportation:`}),(0,u.jsxs)(`select`,{value:n==null?0:n.useType,onChange:t=>B(e,t.target.value,void 0),children:[(0,u.jsx)(`option`,{value:0,children:`How many times will you use this transportation`}),(0,u.jsx)(`option`,{value:1,children:`Limited throughout the trip`}),(0,u.jsx)(`option`,{value:2,children:`Every day of the trip`})]}),(0,u.jsx)(`label`,{children:`Specify the number of times it will be used:`}),(0,u.jsx)(`input`,{type:`number`,min:0,value:n==null?``:n.num,onChange:t=>B(e,n.useType,t.target.value)}),(0,u.jsx)(`p`,{className:`error-msg`,id:`t`+e.transportationId,style:{margin:`0px`,marginBottom:`8px`}})]},t)})})]}),(0,u.jsxs)(`div`,{style:{display:`flex`,flexDirection:`row`,justifyContent:`space-between`},children:[(0,u.jsx)(`button`,{onClick:L,type:`button`,children:`Back`}),(0,u.jsx)(`button`,{onClick:I,type:`button`,children:`Next`})]})]})}var f=d;export{f as default};