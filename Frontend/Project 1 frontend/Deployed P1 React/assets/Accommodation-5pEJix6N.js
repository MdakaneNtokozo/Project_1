import{l as e,m as t,n,s as r,t as i}from"./index-Dy5shDWX.js";import{t as a}from"./Loading-Dkvs0utl.js";import{t as o}from"./dist-B3-LkRQH.js";import"./iconBase-BgoDaE5U.js";import{t as s}from"./bi-CIcH-MPd.js";import{t as c}from"./build-CnW8lL0w.js";var l=t(e()),u=t(o()),d=t(c()),f=t(n());function p(){let[e,t]=(0,l.useState)([]),[n,o]=(0,l.useState)([]),[c,p]=(0,l.useState)([]),[m,h]=(0,l.useState)([]),{api:g,token:_,user:v,currency:y,startDate:b,endDate:x,selectedSpenderType:S,selectedDestination:C,selectedAccommodations:w,setSelectedAccommodations:T,accommList:E,setAccommList:D,accommTotal:O,setAccommTotal:k,selectedBuddies:A}=(0,l.useContext)(i),j=r(),[M,N]=(0,l.useState)(!0),[P,F]=(0,l.useState)(1);for((0,l.useEffect)(()=>{if(e.length==0){var n=g+`Destinations/getAccommodationTypes`;fetch(n,{method:`GET`,headers:{Authorization:`Bearer `+_,"Content-Type":`application/json`}}).then(async e=>{e.status==401&&(console.log(`unauthorized`),j(`/`)),o(await e.json()),n=g+`Destinations/getAccommodations?destId=`+C.destinationId+`&currencyId= `+v.currencyId,fetch(n,{method:`GET`,headers:{Authorization:`Bearer `+_,"Content-Type":`application/json`}}).then(async e=>{t(await e.json()),n=g+`LoginSignup/getSpenderTypes`,fetch(n,{method:`GET`,headers:{Authorization:`Bearer `+_,"Content-Type":`application/json`}}).then(async e=>{h(await e.json()),n=g+`Destinations/getSuggestedAccommodation?spenderTypeId=`+S.spenderTypeId+`&destinationId= `+C.destinationId,fetch(n,{method:`GET`,headers:{Authorization:`Bearer `+_,"Content-Type":`application/json`}}).then(async e=>p(await e.json())),N(!1)})})})}},[P]);M;)return(0,f.jsx)(a,{});let I=e=>{var e=new Date(e);if(e!=null){let t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();return t+`-`+n+`-`+(r<10?`0`+r:r)}};var L=[];E.forEach(e=>{var t=new Date(e.dates[0]),n=new Date(e.dates[1]),r={accomm:e.accomm,dates:[t,n]};L.push(r)});let R=()=>{if(w.length!=E.length)alert(`make sure that you filled in the details for the selected accommodations`);else{var e=g+`Destinations/getAccomsTotal?numOfPeople=`+(A.length+1);fetch(e,{method:`POST`,headers:{Authorization:`Bearer `+_,"Content-Type":`application/json`},body:JSON.stringify(L)}).then(async e=>{k(await e.json()),j(`/vacayPlan/foodSpots`)})}},z=()=>{j(-1)},B=e=>{w.find(t=>t.accommodationId==e.accommodationId)==null?T([...w,e]):(T([...w.filter(t=>t.accommodationId!=e.accommodationId)]),D([...E.filter(t=>t.accomm.accommodationId!=e.accommodationId)]))},V=e=>w.length==0?`card-ui`:w.find(t=>t.accommodationId==e.accommodationId)?`selected-card-ui`:`card-ui`,H=(e,t)=>{if(t.length==2){var n=E.find(t=>t.accomm.accommodationId==e.accommodationId)!=null;if(n==0){var r={accomm:e,dates:t};D([...E,r])}else if(n==1){var r={accomm:e,dates:t};D([...E.filter(t=>t.accomm!=e),r])}}},U=n=>{n==2?t(e.sort((e,t)=>e.accommodationPricePerPerson-t.accommodationPricePerPerson)):n==3?t(e.sort((e,t)=>t.accommodationPricePerPerson-e.accommodationPricePerPerson)):n==4&&t(e.sort((e,t)=>t.accommodationRating-e.accommodationRating)),F(n)};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(`div`,{children:[(0,f.jsxs)(`h2`,{children:[`Select accommodations for `,C.destinationName]}),(0,f.jsxs)(`select`,{value:P,onChange:e=>U(e.target.value),children:[(0,f.jsx)(`option`,{value:1,children:`Filter by:`}),(0,f.jsx)(`option`,{value:2,children:`Lowest - highest`}),(0,f.jsx)(`option`,{value:3,children:`Highest - lowest`}),(0,f.jsx)(`option`,{value:4,children:`Rating`})]}),(0,f.jsx)(`div`,{className:`cards-section`,children:e.length.length==0?(0,f.jsx)(`p`,{children:`no accommodations`}):e.map((e,t)=>{var r=c.find(t=>t.accommodationId==e.accommodationId)!=null;return(0,f.jsxs)(`div`,{className:V(e),onClick:()=>B(e),children:[(0,f.jsxs)(`div`,{className:`card-img`,children:[(0,f.jsx)(`img`,{src:e.accommodationImage}),(0,f.jsx)(`div`,{className:`card-rating`,children:(0,f.jsx)(u.Rating,{initialValue:e.accommodationRating,readonly:!0,allowFraction:!0,size:`20px`})}),r?(0,f.jsx)(`div`,{className:`suggested`,children:(0,f.jsx)(s,{size:`35px`,color:`yellow`})}):(0,f.jsx)(f.Fragment,{})]}),(0,f.jsx)(`p`,{className:`card-title`,children:e.accommodationName}),(0,f.jsx)(`p`,{className:`card-subtitle`,children:e.accommodationAddress}),(0,f.jsxs)(`p`,{children:[y.currencySymbol,` `,e.accommodationPricePerPerson,` per person`]}),(0,f.jsxs)(`p`,{children:[e.accommodationMinNumOfPeople,` - `,e.accommodationMaxNumOfPeople,` people`]}),(0,f.jsxs)(`p`,{children:[n.find(t=>t.accomodationTypeId==e.accomodationTypeId).accommodationTypeName,` `]}),(0,f.jsxs)(`p`,{children:[`Amenities: `,e.accommodationAmenities]})]},t)})})]}),(0,f.jsxs)(`div`,{className:`more-details`,children:[(0,f.jsx)(`h3`,{children:`Fill in details below`}),w.length==0?(0,f.jsx)(`p`,{children:`No accommodation selected`}):(0,f.jsx)(f.Fragment,{children:w.map((e,t)=>{var n=E.find(t=>t.accomm.accommodationId==e.accommodationId);return(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`p`,{className:`card-title`,children:e.accommodationName}),(0,f.jsx)(`label`,{children:`Select check in and check out dates for accommodation:`}),(0,f.jsx)(d.default,{mode:`range`,value:n==null?void 0:[I(n.dates[0]),I(n.dates[1])],range:!0,onChange:t=>H(e,t),mapDays:({date:e})=>{var t={};return E.map(r=>{if(r!=n){var i=I(e),a=I(r.dates[0]),o=I(r.dates[1]),s=new Date(i);s>=new Date(a)&&s<=new Date(o)&&(t.style={backgroundColor:`#71c7f1ff`},t.disabled=!0)}}),t},minDate:b,maxDate:x}),(0,f.jsx)(`br`,{}),(0,f.jsx)(`p`,{className:`error-msg`,id:`a`+e.accommodationId,style:{margin:`0px`,marginBottom:`8px`}})]},t)})})]}),(0,f.jsxs)(`div`,{style:{display:`flex`,flexDirection:`row`,justifyContent:`space-between`},children:[(0,f.jsx)(`button`,{onClick:z,type:`button`,children:`Back`}),(0,f.jsx)(`button`,{onClick:R,type:`button`,children:`Next`})]})]})}var m=p;export{m as default};